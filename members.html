<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="main.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="third_party/ICanHaz.min.js"></script>
  </head>
  <body>

    <!-- Wrap the contents of the page so that if the page is shorter than the height of the browser, it will let the footer stick to the bottom. -->
    <div class='wrap'>

      <!-- Include the header of the website, which is shared throughout. -->
      <header></header>

      <!-- The glow and white fill of the content of the page -->
      <div class='container'>
        <div id="actualContent" class="whitefill blackglow">
          <center><h2><span class='text-danger'>Deep Treble</span> Members</h2></center>
          <script id="members" type="text/html">
            <div class='row'>
              {{#members}}
                <center><h3>{{voice}}</h3></center>
                {{#people}}
                  <div class="no-margin media col-sm-4 {{#getClass}}{{/getClass}}">
                    <img class="pull-left" src="{{#getImage}}{{/getImage}}" class="media-object" onError="this.onerror=null;this.src='images/members/missing_photo';" data-src="holder.js/100x100" alt="100x100" style="width: 100px;height: 100px;" color="black">
                    <div class="media-body">
                      <h4 class="media-heading">{{name}}</h4>
                      Class of {{year}}
                      {{#formatPos}}{{position}}{{/formatPos}}
                    </div>
                  </div>
                  {{#fixWhiteSpace}}{{/fixWhiteSpace}}
                {{/people}}
                {{#fixWhiteSpace2}}{{/fixWhiteSpace2}}
              {{/members}}
            </div>
            <div class='whitespace'></div>
          </script>
        </div>
      </div>
      <div id='push'></div>
    </div>
    <footer></footer>
    <script type="text/javascript">
      $(document).ready(function() {
        'use strict';

        // Render our headers and footers.
        $.get('header.html', function(data) {
          var template = ich.addTemplate('header', data);
          var node = ich.header({});
          $('header').html(node);
        });
        $.get('footer.html', function(data) {
          var template = ich.addTemplate('footer', data);
          var node = ich.footer({});
          $('footer').html(node);
        });

        
        var isLeft = true;
        var view = {

          /** Helper function to get the image of a member. */
          getImage: function() {
            return function(text, render) {
              return 'images/members/' + this.name.replace(/ /g,'').toLowerCase();
            }
          },

          /**
           * Helper function to get class for people on the left side when it's
           * double-column layout.
           */
          getClass: function() {
            return function() {
              if (this.isLeft === undefined) {
                this.isLeft = isLeft;
              } else {
                isLeft = !isLeft;
              }
              return this.isLeft ? 'col-sm-offset-2' : '';
            }
          },

          /** Helper function to get text for eboard position if it exists */
          formatPos: function() {
            return function(text, render) {
              var pos = render(text);
              return pos ? '<br>' + pos : '';
            }
          },

          /** 
           * Helper function to make trailing whitespace for people on the
           * right side of the double column layout.
           */
          fixWhiteSpace: function() {
            return function() {
              if (this.isLeft === undefined) {
                this.isLeft = isLeft;
              } else {
                isLeft = !isLeft;
              }
              return this.isLeft ? '' :
                '</div><div class="whitespace"></div><div class="row">';
            }
          },

          /** 
           * Helper function to make trailing whitespace for when there is a
           * section ending with a person on the left side.
           */
          fixWhiteSpace2: function() {
            return function() {
              var ret = isLeft ?
                '</div><div class="whitespace"></div><div class="row">' : '';
              if (!isLeft) {
                isLeft = !isLeft;
              }
              return ret;
            }
          }
        };

        $.getJSON('data/members.json', function(data) {
          // Add member data to the "view"
          view.members = data;
          // Render the members data.
          var mem = ich.members(view);
          $('#actualContent').append(mem);
        });
      });
    </script>
    <script src="js/background.js"></script>
  </body>
</html>
